#Requires -Version 5.1

# ğŸŒŠ Phoenix 95 Enterprise V4 Enhanced - PowerShell ìë™í™” ìŠ¤í¬ë¦½íŠ¸
# Windows/Linux/macOS í™˜ê²½ì—ì„œ ì™„ì „ ìë™í™” ë°°í¬ ë° ê´€ë¦¬

<#
.SYNOPSIS
    Phoenix 95 V4 Enhanced ì‹œìŠ¤í…œ ì™„ì „ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ (í¬ë¡œìŠ¤ í”Œë«í¼)
    
.DESCRIPTION
    Phoenix 95 V4 Enhanced ì‹œìŠ¤í…œì˜ Windows/Linux/macOS í™˜ê²½ ìë™ ì„¤ì¹˜,
    ë°°í¬, ê´€ë¦¬ë¥¼ ìœ„í•œ ì™„ì „ ìë™í™” PowerShell ìŠ¤í¬ë¦½íŠ¸
    
.PARAMETER Action
    ì‹¤í–‰í•  ì‘ì—…: Install, Deploy, Start, Stop, Update, Monitor, Backup, Rollback, Test
    
.PARAMETER Environment
    í™˜ê²½: Development, Staging, Production
    
.PARAMETER Platform
    í”Œë«í¼: Windows, Linux, macOS, Auto (ìë™ ê°ì§€)
    
.EXAMPLE
    .\Phoenix95-V4-Automation.ps1 -Action Install -Environment Production
    .\Phoenix95-V4-Automation.ps1 -Action Deploy -Environment Development
    .\Phoenix95-V4-Automation.ps1 -Action Monitor
    .\Phoenix95-V4-Automation.ps1 -Action Test -IncludeTests
#>

param(
    [Parameter(Mandatory=$true)]
    [ValidateSet("Install", "Deploy", "Start", "Stop", "Update", "Monitor", "Backup", "Rollback", "Test")]
    [string]$Action,
    
    [Parameter(Mandatory=$false)]
    [ValidateSet("Development", "Staging", "Production")]
    [string]$Environment = "Development",
    
    [Parameter(Mandatory=$false)]
    [ValidateSet("Windows", "Linux", "macOS", "Auto")]
    [string]$Platform = "Auto",
    
    [Parameter(Mandatory=$false)]
    [string]$ConfigPath = ".\config\phoenix95_config.json",
    
    [Parameter(Mandatory=$false)]
    [switch]$Silent,
    
    [Parameter(Mandatory=$false)]
    [switch]$Force,
    
    [Parameter(Mandatory=$false)]
    [switch]$IncludeTests
)

# ê¸€ë¡œë²Œ ë³€ìˆ˜ ì„¤ì •
$script:LogFile = ".\logs\phoenix95_automation_$(Get-Date -Format 'yyyyMMdd_HHmmss').log"
$script:BaseDir = Split-Path -Parent $MyInvocation.MyCommand.Path
$script:StartTime = Get-Date
$script:CurrentPlatform = $Platform

# í”Œë«í¼ ìë™ ê°ì§€ (ì›ë³¸ c.txt ëˆ„ë½ ê¸°ëŠ¥)
if ($Platform -eq "Auto") {
    if ($IsWindows -or $env:OS -eq "Windows_NT") {
        $script:CurrentPlatform = "Windows"
    } elseif ($IsLinux) {
        $script:CurrentPlatform = "Linux"
    } elseif ($IsMacOS) {
        $script:CurrentPlatform = "macOS"
    } else {
        $script:CurrentPlatform = "Windows"  # ê¸°ë³¸ê°’
    }
}

# V4 ì‹œìŠ¤í…œ ì„¤ì • (ì›ë³¸ ì—…ê·¸ë ˆì´ë“œ)
$script:V4Config = @{
    SystemName = "Phoenix95-V4-Enhanced"
    Version = "4.0.0"
    TelegramToken = "7386542811:AAEZ21p30rES1k8NxNM2xbZ53U44PI9D5CY"
    TelegramChatId = "7590895952"
    WebhookSecret = "phoenix_complete_webhook_2025_ultra_secure"
    LeverageConfig = @{
        Leverage = 20
        MarginMode = "ISOLATED"
        StopLossPercent = 0.02
        TakeProfitPercent = 0.02
    }
    TradingConfig = @{
        MinConfidence = 0.25
        Phoenix95Threshold = 0.45
        MaxPositionSize = 0.15
    }
    ServicePorts = @{
        "api-gateway-enterprise" = 8100
        "signal-ingestion-pro" = 8101
        "market-data-intelligence" = 8102
        "phoenix95-ai-engine" = 8103
        "risk-management-advanced" = 8104
        "portfolio-optimizer-quant" = 8105
        "trade-execution-leverage" = 8106
        "position-tracker-realtime" = 8107
        "compliance-monitor-regulatory" = 8108
        "notification-hub-intelligent" = 8109
        "client-dashboard-analytics" = 8110
    }
}

# ë¡œê¹… í•¨ìˆ˜ (ì›ë³¸ ê¸°ë°˜ + í¬ë¡œìŠ¤ í”Œë«í¼ ì§€ì›)
function Write-Log {
    param(
        [Parameter(Mandatory=$true)]
        [string]$Message,
        
        [Parameter(Mandatory=$false)]
        [ValidateSet("INFO", "WARN", "ERROR", "SUCCESS")]
        [string]$Level = "INFO"
    )
    
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $logEntry = "[$timestamp] [$Level] [$script:CurrentPlatform] $Message"
    
    # ì½˜ì†” ì¶œë ¥ (ìƒ‰ìƒ í¬í•¨) - ì›ë³¸ê³¼ ë™ì¼
    switch ($Level) {
        "INFO"    { Write-Host $logEntry -ForegroundColor White }
        "WARN"    { Write-Host $logEntry -ForegroundColor Yellow }
        "ERROR"   { Write-Host $logEntry -ForegroundColor Red }
        "SUCCESS" { Write-Host $logEntry -ForegroundColor Green }
    }
    
    # íŒŒì¼ ë¡œê¹… - ì›ë³¸ê³¼ ë™ì¼
    if (-not (Test-Path (Split-Path $script:LogFile))) {
        New-Item -ItemType Directory -Path (Split-Path $script:LogFile) -Force | Out-Null
    }
    Add-Content -Path $script:LogFile -Value $logEntry
}

# í”Œë«í¼ë³„ ëª…ë ¹ì–´ ì‹¤í–‰ í•¨ìˆ˜ (ì›ë³¸ c.txt ëˆ„ë½ ê¸°ëŠ¥)
function Invoke-PlatformCommand {
    param(
        [string]$WindowsCommand,
        [string]$LinuxCommand,
        [string]$MacCommand = $LinuxCommand
    )
    
    switch ($script:CurrentPlatform) {
        "Windows" { 
            if ($WindowsCommand) { Invoke-Expression $WindowsCommand }
        }
        "Linux" { 
            if ($LinuxCommand) { bash -c $LinuxCommand }
        }
        "macOS" { 
            if ($MacCommand) { bash -c $MacCommand }
        }
    }
}

# í•„ìˆ˜ ìš”ì†Œ í™•ì¸ í•¨ìˆ˜ (ì›ë³¸ ìœ ì§€ + í¬ë¡œìŠ¤ í”Œë«í¼ ê°œì„ )
function Test-Prerequisites {
    Write-Log "ğŸ” ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸ ì¤‘..." "INFO"
    
    $prerequisites = @()
    
    # Python ì„¤ì¹˜ í™•ì¸ (ì›ë³¸ê³¼ ë™ì¼í•œ ë°©ì‹)
    try {
        $pythonCmd = if ($script:CurrentPlatform -eq "Windows") { "python" } else { "python3" }
        $pythonVersion = & $pythonCmd --version 2>$null
        if ($pythonVersion) {
            Write-Log "âœ… Python ì„¤ì¹˜ë¨: $pythonVersion" "SUCCESS"
        } else {
            $prerequisites += "Python 3.8+ ì„¤ì¹˜ í•„ìš”"
        }
    } catch {
        $prerequisites += "Python 3.8+ ì„¤ì¹˜ í•„ìš”"
    }
    
    # Docker ì„¤ì¹˜ í™•ì¸ (ì›ë³¸ê³¼ ë™ì¼í•œ ë°©ì‹)
    try {
        $dockerVersion = docker --version 2>$null
        if ($dockerVersion) {
            Write-Log "âœ… Docker ì„¤ì¹˜ë¨: $dockerVersion" "SUCCESS"
            
            # Docker ì„œë¹„ìŠ¤ ì‹¤í–‰ í™•ì¸ (ì›ë³¸ c.txt í•µì‹¬ ê¸°ëŠ¥)
            try {
                docker info 2>$null | Out-Null
                Write-Log "âœ… Docker ì„œë¹„ìŠ¤ ì‹¤í–‰ ì¤‘" "SUCCESS"
            } catch {
                Write-Log "âš ï¸ Dockerê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ë§Œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ" "WARN"
                $prerequisites += "Docker ì„œë¹„ìŠ¤ ì‹œì‘ í•„ìš”"
            }
        } else {
            $prerequisites += if ($script:CurrentPlatform -eq "Windows") { "Docker Desktop ì„¤ì¹˜ í•„ìš”" } else { "Docker ì„¤ì¹˜ í•„ìš”" }
        }
    } catch {
        $prerequisites += if ($script:CurrentPlatform -eq "Windows") { "Docker Desktop ì„¤ì¹˜ í•„ìš”" } else { "Docker ì„¤ì¹˜ í•„ìš”" }
    }
    
    # Git ì„¤ì¹˜ í™•ì¸ (ì›ë³¸ê³¼ ë™ì¼)
    try {
        $gitVersion = git --version 2>$null
        if ($gitVersion) {
            Write-Log "âœ… Git ì„¤ì¹˜ë¨: $gitVersion" "SUCCESS"
        } else {
            $prerequisites += "Git ì„¤ì¹˜ í•„ìš”"
        }
    } catch {
        $prerequisites += "Git ì„¤ì¹˜ í•„ìš”"
    }
    
    # PowerShell ë²„ì „ í™•ì¸ (ì›ë³¸ê³¼ ë™ì¼)
    if ($PSVersionTable.PSVersion.Major -ge 5) {
        Write-Log "âœ… PowerShell ë²„ì „: $($PSVersionTable.PSVersion)" "SUCCESS"
    } else {
        $prerequisites += "PowerShell 5.1+ í•„ìš”"
    }
    
    # Windows íŠ¹í™” í™•ì¸ (ì›ë³¸ c.txt í•µì‹¬ ìœ ì§€)
    if ($script:CurrentPlatform -eq "Windows") {
        # ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ (ì›ë³¸ê³¼ ë™ì¼)
        $currentUser = [Security.Principal.WindowsIdentity]::GetCurrent()
        $principal = New-Object Security.Principal.WindowsPrincipal($currentUser)
        if ($principal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
            Write-Log "âœ… ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ ì¤‘" "SUCCESS"
        } else {
            $prerequisites += "ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ í•„ìš”"
        }
    }
    
    # ìµœì¢… ê²°ê³¼ (ì›ë³¸ê³¼ ë™ì¼í•œ ë¡œì§)
    if ($prerequisites.Count -gt 0) {
        Write-Log "âŒ ë‹¤ìŒ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•´ì•¼ í•©ë‹ˆë‹¤:" "ERROR"
        foreach ($req in $prerequisites) {
            Write-Log "   - $req" "ERROR"
        }
        return $false
    }
    
    Write-Log "âœ… ëª¨ë“  ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ ì¶©ì¡±" "SUCCESS"
    return $true
}

# Phoenix 95 V4 ì„¤ì¹˜ í•¨ìˆ˜ (ì›ë³¸ ê¸°ë°˜ + í¬ë¡œìŠ¤ í”Œë«í¼ ê°œì„ )
function Install-Phoenix95V4 {
    Write-Log "ğŸš€ Phoenix 95 V4 Enhanced ì„¤ì¹˜ ì‹œì‘" "INFO"
    
    try {
        # 1. ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„± (í”Œë«í¼ë³„)
        $workDir = switch ($script:CurrentPlatform) {
            "Windows" { "C:\Phoenix95-V4-Enhanced" }
            "Linux" { "$HOME/Phoenix95-V4-Enhanced" }
            "macOS" { "$HOME/Phoenix95-V4-Enhanced" }
        }
        
        if (-not (Test-Path $workDir)) {
            New-Item -ItemType Directory -Path $workDir -Force | Out-Null
            Write-Log "ğŸ“ ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„±: $workDir" "SUCCESS"
        }
        
        Set-Location $workDir
        
        # 2. Git ë¦¬í¬ì§€í† ë¦¬ í´ë¡  (ì‹œë®¬ë ˆì´ì…˜) - ì›ë³¸ê³¼ ë™ì¼
        Write-Log "ğŸ“¥ Phoenix 95 V4 ì†ŒìŠ¤ ì½”ë“œ ë‹¤ìš´ë¡œë“œ ì¤‘..." "INFO"
        
        # DDD í´ë” êµ¬ì¡° ìƒì„± (ì›ë³¸ a.txt ê¸°ë°˜)
        $folders = @(
            "services\api-gateway-enterprise\domain\aggregates",
            "services\signal-ingestion-pro\domain\aggregates", 
            "services\market-data-intelligence\domain\aggregates",
            "services\phoenix95-ai-engine\domain\aggregates",
            "services\risk-management-advanced\domain\aggregates",
            "services\portfolio-optimizer-quant\domain\aggregates",
            "services\trade-execution-leverage\domain\aggregates",
            "services\position-tracker-realtime\domain\aggregates",
            "services\compliance-monitor-regulatory\domain\aggregates",
            "services\notification-hub-intelligent\domain\aggregates",
            "services\client-dashboard-analytics\domain\aggregates",
            "services\system-orchestration\domain\aggregates",
            "shared\domain\aggregates",
            "shared\infrastructure\repositories",
            "shared\config",
            "shared\utils",
            "shared\models",
            "infrastructure\data_storage\postgresql",
            "infrastructure\data_storage\redis",
            "infrastructure\data_storage\influxdb",
            "infrastructure\monitoring\prometheus",
            "infrastructure\monitoring\grafana",
            "tools",
            "scripts",
            "logs",
            "config",
            "tests\integration",
            "tests\performance",
            "tests\security"
        )
        
        foreach ($folder in $folders) {
            $fullPath = Join-Path $workDir $folder
            if (-not (Test-Path $fullPath)) {
                New-Item -ItemType Directory -Path $fullPath -Force | Out-Null
            }
        }
        Write-Log "âœ… DDD í´ë” êµ¬ì¡° ìƒì„± ì™„ë£Œ" "SUCCESS"
        
        # 3. V4 í˜¸í™˜ ì„¤ì • íŒŒì¼ ìƒì„± (ì›ë³¸ b.txt ê¸°ë°˜ + V4 ì „ìš©)
        Write-Log "âš™ï¸ V4 í˜¸í™˜ ì„¤ì • íŒŒì¼ ìƒì„± ì¤‘..." "INFO"
        
        $telegramConfigPath = Join-Path $workDir "shared\config\telegram_config.py"
        $telegramConfig = @"
"""
Telegram ì„¤ì • - Phoenix 95 V4 Enhanced
"""

TELEGRAM_CONFIG = {
    "token": "$($script:V4Config.TelegramToken)",
    "chat_id": "$($script:V4Config.TelegramChatId)",
    "enabled": True,
    "timeout": 30,
    "retry_count": 3,
    "parse_mode": "HTML"
}

def send_telegram_signal(message):
    """V4 í˜¸í™˜ í…”ë ˆê·¸ë¨ ì „ì†¡ í•¨ìˆ˜"""
    import requests
    import time
    
    url = f"https://api.telegram.org/bot{TELEGRAM_CONFIG['token']}/sendMessage"
    data = {
        'chat_id': TELEGRAM_CONFIG['chat_id'],
        'text': message,
        'parse_mode': TELEGRAM_CONFIG['parse_mode']
    }
    
    for attempt in range(TELEGRAM_CONFIG['retry_count']):
        try:
            response = requests.post(url, data=data, timeout=TELEGRAM_CONFIG['timeout'])
            if response.status_code == 200:
                return True
            else:
                print(f"í…”ë ˆê·¸ë¨ ì „ì†¡ ì‹¤íŒ¨ (ì‹œë„ {attempt + 1}): HTTP {response.status_code}")
        except Exception as e:
            print(f"í…”ë ˆê·¸ë¨ ì „ì†¡ ì˜¤ë¥˜ (ì‹œë„ {attempt + 1}): {e}")
            if attempt < TELEGRAM_CONFIG['retry_count'] - 1:
                time.sleep(2 ** attempt)  # ì§€ìˆ˜ ë°±ì˜¤í”„
    
    return False
"@
        Set-Content -Path $telegramConfigPath -Value $telegramConfig -Encoding UTF8
        
        $leverageConfigPath = Join-Path $workDir "shared\config\leverage_config.py"
        $leverageConfig = @"
"""
ë ˆë²„ë¦¬ì§€ ì„¤ì • - Phoenix 95 V4 Enhanced
20x ISOLATED ë ˆë²„ë¦¬ì§€ íŠ¸ë ˆì´ë”© + ë¦¬ìŠ¤í¬ ê´€ë¦¬ ê°•í™”
"""

LEVERAGE_CONFIG = {
    "leverage": $($script:V4Config.LeverageConfig.Leverage),
    "margin_mode": "$($script:V4Config.LeverageConfig.MarginMode)",
    "stop_loss_percent": $($script:V4Config.LeverageConfig.StopLossPercent),
    "take_profit_percent": $($script:V4Config.LeverageConfig.TakeProfitPercent),
    "max_margin_ratio": 0.8,
    "liquidation_buffer": 0.1,
    "maintenance_margin": 0.004,
    "trading_fee": 0.0004,
    "max_position_count": 5,
    "daily_loss_limit": 0.05,
    "risk_per_trade": 0.02
}

# ë¦¬ìŠ¤í¬ ê´€ë¦¬ í•¨ìˆ˜
def calculate_position_size(account_balance, risk_percent, stop_loss_percent):
    """í¬ì§€ì…˜ í¬ê¸° ê³„ì‚°"""
    risk_amount = account_balance * risk_percent
    position_size = risk_amount / stop_loss_percent
    max_position = account_balance * LEVERAGE_CONFIG["max_margin_ratio"] / LEVERAGE_CONFIG["leverage"]
    return min(position_size, max_position)

def validate_leverage_settings():
    """ë ˆë²„ë¦¬ì§€ ì„¤ì • ê²€ì¦"""
    required_keys = ["leverage", "margin_mode", "stop_loss_percent", "take_profit_percent"]
    for key in required_keys:
        if key not in LEVERAGE_CONFIG:
            raise ValueError(f"í•„ìˆ˜ ë ˆë²„ë¦¬ì§€ ì„¤ì • ëˆ„ë½: {key}")
    
    if LEVERAGE_CONFIG["leverage"] > 100:
        raise ValueError("ë ˆë²„ë¦¬ì§€ê°€ 100ë°°ë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
    
    return True
"@
        Set-Content -Path $leverageConfigPath -Value $leverageConfig -Encoding UTF8
        
        $tradingConfigPath = Join-Path $workDir "shared\config\trading_config.py"
        $tradingConfig = @"
"""
ê±°ë˜ ì„¤ì • - Phoenix 95 V4 Enhanced
"""

TRADING_CONFIG = {
    "allowed_symbols": [
        "BTCUSDT", "ETHUSDT", "BNBUSDT", "ADAUSDT", "DOGEUSDT", 
        "XRPUSDT", "SOLUSDT", "AVAXUSDT", "DOTUSDT", "LINKUSDT"
    ],
    "min_confidence": $($script:V4Config.TradingConfig.MinConfidence),
    "phoenix_95_threshold": $($script:V4Config.TradingConfig.Phoenix95Threshold),
    "max_position_size": $($script:V4Config.TradingConfig.MaxPositionSize),
    "kelly_fraction": 0.20,
    "quality_threshold": 0.55,
    "real_data_weight": 0.85,
    "phoenix_95_weight": 0.95,
    "min_trade_amount": 10.0,
    "max_trade_amount": 10000.0,
    "cooldown_period": 300,  # 5ë¶„ ì¿¨ë‹¤ìš´
    "market_hours_only": False,
    "weekend_trading": True
}

# ê±°ë˜ ê²€ì¦ í•¨ìˆ˜
def validate_trading_signal(signal):
    """ê±°ë˜ ì‹ í˜¸ ê²€ì¦"""
    required_fields = ["symbol", "side", "confidence"]
    for field in required_fields:
        if field not in signal:
            return False, f"í•„ìˆ˜ í•„ë“œ ëˆ„ë½: {field}"
    
    if signal["symbol"] not in TRADING_CONFIG["allowed_symbols"]:
        return False, f"í—ˆìš©ë˜ì§€ ì•Šì€ ì‹¬ë³¼: {signal['symbol']}"
    
    if signal["confidence"] < TRADING_CONFIG["min_confidence"]:
        return False, f"ì‹ ë¢°ë„ ë¶€ì¡±: {signal['confidence']}"
    
    return True, "ê²€ì¦ ì„±ê³µ"

def get_trading_status():
    """í˜„ì¬ ê±°ë˜ ìƒíƒœ ë°˜í™˜"""
    import datetime
    now = datetime.datetime.now()
    
    return {
        "trading_enabled": True,
        "current_time": now.isoformat(),
        "platform": "$script:CurrentPlatform",
        "config_loaded": True
    }
"@
        Set-Content -Path $tradingConfigPath -Value $tradingConfig -Encoding UTF8
        
        Write-Log "âœ… V4 í˜¸í™˜ ì„¤ì • íŒŒì¼ ìƒì„± ì™„ë£Œ" "SUCCESS"
        
        # 4. Python ê°€ìƒí™˜ê²½ ìƒì„± (ì›ë³¸ ê¸°ë°˜ + í¬ë¡œìŠ¤ í”Œë«í¼)
        Write-Log "ğŸ Python ê°€ìƒí™˜ê²½ ìƒì„± ì¤‘..." "INFO"
        
        $pythonCmd = switch ($script:CurrentPlatform) {
            "Windows" { "python" }
            default { "python3" }
        }
        
        Invoke-PlatformCommand -WindowsCommand "$pythonCmd -m venv venv" -LinuxCommand "$pythonCmd -m venv venv"
        
        # ê°€ìƒí™˜ê²½ í™œì„±í™” ë° íŒ¨í‚¤ì§€ ì„¤ì¹˜
        $activateCmd = switch ($script:CurrentPlatform) {
            "Windows" { ".\venv\Scripts\Activate.ps1" }
            "Linux" { "source venv/bin/activate" }
            "macOS" { "source venv/bin/activate" }
        }
        
        $pipCmd = switch ($script:CurrentPlatform) {
            "Windows" { ".\venv\Scripts\pip" }
            default { "./venv/bin/pip" }
        }
        
        # íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ì›ë³¸ ê¸°ë°˜)
        $basePackages = @(
            "fastapi", "uvicorn[standard]", "asyncpg", "redis", "influxdb-client",
            "pydantic", "pytest", "locust", "requests", "websockets",
            "numpy", "pandas", "aiohttp", "sqlalchemy", "alembic"
        )
        
        switch ($script:CurrentPlatform) {
            "Windows" {
                Invoke-Expression "& `"$activateCmd`"; $pipCmd install --upgrade pip"
                Invoke-Expression "$pipCmd install $($basePackages -join ' ')"
                # Windows ì „ìš© íŒ¨í‚¤ì§€
                Invoke-Expression "$pipCmd install pywin32 wmi"
            }
            default {
                bash -c "$activateCmd && $pipCmd install --upgrade pip"
                bash -c "$pipCmd install $($basePackages -join ' ')"
                # Linux/macOS ì „ìš© íŒ¨í‚¤ì§€
                bash -c "$pipCmd install psutil"
            }
        }
        
        Write-Log "âœ… Python í™˜ê²½ ì„¤ì • ì™„ë£Œ" "SUCCESS"
        
        # 5. Docker Compose íŒŒì¼ ìƒì„± (ì›ë³¸ ê¸°ë°˜ + ê°œì„ )
        Write-Log "ğŸ³ Docker Compose ì„¤ì • ìƒì„± ì¤‘..." "INFO"
        
        $dockerComposePath = Join-Path $workDir "docker-compose.yml"
        $dockerComposeContent = @"
version: '3.8'

services:
  postgresql:
    image: postgres:15
    environment:
      POSTGRES_DB: phoenix95_v4
      POSTGRES_USER: phoenix95
      POSTGRES_PASSWORD: phoenix95_secure_pass_2025
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./infrastructure/data_storage/postgresql/schemas:/docker-entrypoint-initdb.d
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U phoenix95"]
      interval: 30s
      timeout: 10s
      retries: 3

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3

  influxdb:
    image: influxdb:2.7
    environment:
      DOCKER_INFLUXDB_INIT_MODE: setup
      DOCKER_INFLUXDB_INIT_USERNAME: phoenix95
      DOCKER_INFLUXDB_INIT_PASSWORD: phoenix95_influx_2025
      DOCKER_INFLUXDB_INIT_ORG: phoenix95
      DOCKER_INFLUXDB_INIT_BUCKET: trading_data
    ports:
      - "8086:8086"
    volumes:
      - influx_data:/var/lib/influxdb2
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8086/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./infrastructure/monitoring/prometheus:/etc/prometheus
      - prometheus_data:/prometheus
    restart: unless-stopped
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      GF_SECURITY_ADMIN_PASSWORD: phoenix95_grafana_2025
      GF_INSTALL_PLUGINS: grafana-clock-panel,grafana-simple-json-datasource
    volumes:
      - grafana_data:/var/lib/grafana
      - ./infrastructure/monitoring/grafana:/etc/grafana/provisioning
    restart: unless-stopped
    depends_on:
      - prometheus

volumes:
  postgres_data:
  redis_data:
  influx_data:
  grafana_data:
  prometheus_data:

networks:
  default:
    name: phoenix95_network
"@
        Set-Content -Path $dockerComposePath -Value $dockerComposeContent -Encoding UTF8
        
        # Prometheus ì„¤ì • íŒŒì¼ ìƒì„± (ì›ë³¸ c.txt ëˆ„ë½ ê¸°ëŠ¥)
        $prometheusConfigPath = Join-Path $workDir "infrastructure\monitoring\prometheus\prometheus.yml"
        if (-not (Test-Path (Split-Path $prometheusConfigPath))) {
            New-Item -ItemType Directory -Path (Split-Path $prometheusConfigPath) -Force | Out-Null
        }
        
        $prometheusConfig = @"
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

scrape_configs:
  - job_name: 'phoenix95-v4-services'
    static_configs:
      - targets: ['host.docker.internal:8100', 'host.docker.internal:8103', 'host.docker.internal:8106']
    scrape_interval: 10s
    metrics_path: /metrics
"@
        Set-Content -Path $prometheusConfigPath -Value $prometheusConfig -Encoding UTF8
        
        Write-Log "âœ… Docker Compose ì„¤ì • ìƒì„± ì™„ë£Œ" "SUCCESS"
        
        # 6. í™˜ê²½ë³„ ì„¤ì • íŒŒì¼ ìƒì„± (ì›ë³¸ ê¸°ë°˜)
        $envConfigPath = Join-Path $workDir "config\$Environment.json"
        $envConfig = @{
            Environment = $Environment
            Platform = $script:CurrentPlatform
            DatabaseUrl = "postgresql://phoenix95:phoenix95_secure_pass_2025@localhost:5432/phoenix95_v4"
            RedisUrl = "redis://localhost:6379"
            InfluxDBUrl = "http://localhost:8086"
            TelegramConfig = $script:V4Config | ConvertTo-Json
            LogLevel = if ($Environment -eq "Production") { "WARNING" } else { "DEBUG" }
            DebugMode = $Environment -ne "Production"
            EnableMetrics = $true
            EnableHealthCheck = $true
            MaxConnections = 100
            TimeoutSeconds = 30
        } | ConvertTo-Json -Depth 4
        
        if (-not (Test-Path (Split-Path $envConfigPath))) {
            New-Item -ItemType Directory -Path (Split-Path $envConfigPath) -Force | Out-Null
        }
        Set-Content -Path $envConfigPath -Value $envConfig -Encoding UTF8
        
        # 7. ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (í”Œë«í¼ë³„)
        Write-Log "ğŸ“œ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘..." "INFO"
        
        $startScript = switch ($script:CurrentPlatform) {
            "Windows" {
                @"
@echo off
echo ğŸŒŠ Phoenix 95 V4 Enhanced ì‹œì‘ ì¤‘...
cd /d "%~dp0"
docker-compose up -d
timeout /t 30 /nobreak >nul
echo âœ… Phoenix 95 V4 ì‹œì‘ ì™„ë£Œ!
pause
"@
            }
            default {
                @"
#!/bin/bash
echo "ğŸŒŠ Phoenix 95 V4 Enhanced ì‹œì‘ ì¤‘..."
cd "$(dirname "$0")"
docker-compose up -d
sleep 30
echo "âœ… Phoenix 95 V4 ì‹œì‘ ì™„ë£Œ!"
"@
            }
        }
        
        $scriptExtension = if ($script:CurrentPlatform -eq "Windows") { ".bat" } else { ".sh" }
        $startScriptPath = Join-Path $workDir "start_phoenix95$scriptExtension"
        Set-Content -Path $startScriptPath -Value $startScript -Encoding UTF8
        
        # Linux/macOSì—ì„œ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
        if ($script:CurrentPlatform -ne "Windows") {
            chmod +x $startScriptPath
        }
        
        Write-Log "âœ… Phoenix 95 V4 Enhanced ì„¤ì¹˜ ì™„ë£Œ!" "SUCCESS"
        return $true
        
    } catch {
        Write-Log "âŒ ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: $($_.Exception.Message)" "ERROR"
        return $false
    }
}

# ì„œë¹„ìŠ¤ ë°°í¬ í•¨ìˆ˜ (ì›ë³¸ ìœ ì§€ + ê°œì„ )
function Deploy-Phoenix95V4 {
    Write-Log "ğŸš€ Phoenix 95 V4 Enhanced ë°°í¬ ì‹œì‘" "INFO"
    
    try {
        $workDir = switch ($script:CurrentPlatform) {
            "Windows" { "C:\Phoenix95-V4-Enhanced" }
            default { "$HOME/Phoenix95-V4-Enhanced" }
        }
        Set-Location $workDir
        
        # 1. Docker ì¸í”„ë¼ ì‹œì‘ (ì›ë³¸ê³¼ ë™ì¼í•œ ë‹¨ìˆœí•¨)
        Write-Log "ğŸ³ Docker ì¸í”„ë¼ ì‹œì‘ ì¤‘..." "INFO"
        docker-compose up -d
        
        # 2. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ëŒ€ê¸° (ì›ë³¸ c.txtì™€ ë™ì¼)
        Write-Log "ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘..." "INFO"
        Start-Sleep -Seconds 30
        
        # 3. ê¸°ë³¸ í—¬ìŠ¤ì²´í¬ (ì›ë³¸ c.txt ìŠ¤íƒ€ì¼ ìœ ì§€ + í¬ë¡œìŠ¤ í”Œë«í¼)
        Write-Log "ğŸ” ì¸í”„ë¼ í—¬ìŠ¤ì²´í¬ ì¤‘..." "INFO"
        
        $healthChecks = @{
            "PostgreSQL" = 5432
            "Redis" = 6379
            "InfluxDB" = 8086
        }
        
        foreach ($service in $healthChecks.Keys) {
            $port = $healthChecks[$service]
            try {
                if ($script:CurrentPlatform -eq "Windows") {
                    $result = Test-NetConnection -ComputerName localhost -Port $port -WarningAction SilentlyContinue
                    if ($result.TcpTestSucceeded) {
                        Write-Log "âœ… $service ì—°ê²° ì„±ê³µ" "SUCCESS"
                    } else {
                        Write-Log "âŒ $service ì—°ê²° ì‹¤íŒ¨" "ERROR"
                        if (-not $Force) { return $false }
                    }
                } else {
                    $result = nc -z localhost $port 2>$null
                    if ($LASTEXITCODE -eq 0) {
                        Write-Log "âœ… $service ì—°ê²° ì„±ê³µ" "SUCCESS"
                    } else {
                        Write-Log "âŒ $service ì—°ê²° ì‹¤íŒ¨" "ERROR"
                        if (-not $Force) { return $false }
                    }
                }
            } catch {
                Write-Log "âš ï¸ $service ì—°ê²° í™•ì¸ ì¤‘..." "WARN"
            }
        }
        
        # 4. V4 ì„œë¹„ìŠ¤ ì‹œì‘ (ì›ë³¸ c.txtì™€ ìœ ì‚¬í•œ ë‹¨ìˆœí•¨)
        Write-Log "ğŸŒŠ Phoenix 95 V4 ì„œë¹„ìŠ¤ ì‹œì‘ ì¤‘..." "INFO"
        
        # ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë³„ ì‹œì‘ (ì‹œë®¬ë ˆì´ì…˜)
        $services = @(
            "api-gateway-enterprise:8100",
            "signal-ingestion-pro:8101", 
            "market-data-intelligence:8102",
            "phoenix95-ai-engine:8103",
            "trade-execution-leverage:8106",
            "position-tracker-realtime:8107",
            "notification-hub-intelligent:8109"
        )
        
        foreach ($service in $services) {
            $serviceName, $port = $service -split ":"
            Write-Log "âš¡ $serviceName ì‹œì‘ ì¤‘ (í¬íŠ¸: $port)..." "INFO"
            
            # ì„œë¹„ìŠ¤ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (ë‹¨ìˆœí•œ ë°©ì‹)
            $serviceScript = if ($script:CurrentPlatform -eq "Windows") {
                @"
# $serviceName ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸
cd services\$serviceName
..\..\..\venv\Scripts\python.exe main.py --port $port --environment $Environment
"@
            } else {
                @"
#!/bin/bash
cd services/$serviceName
../../../venv/bin/python main.py --port $port --environment $Environment
"@
            }
            
            $scriptExtension = if ($script:CurrentPlatform -eq "Windows") { ".ps1" } else { ".sh" }
            $scriptPath = Join-Path $workDir "scripts\start_$serviceName$scriptExtension"
            
            if (-not (Test-Path (Split-Path $scriptPath))) {
                New-Item -ItemType Directory -Path (Split-Path $scriptPath) -Force | Out-Null
            }
            
            Set-Content -Path $scriptPath -Value $serviceScript -Encoding UTF8
            
            # Linux/macOSì—ì„œ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
            if ($script:CurrentPlatform -ne "Windows") {
                chmod +x $scriptPath
            }
            
            # ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë¹„ìŠ¤ ì‹œì‘
            Start-Job -Name $serviceName -ScriptBlock {
                param($scriptPath, $platform)
                if ($platform -eq "Windows") {
                    & $scriptPath
                } else {
                    bash $scriptPath
                }
            } -ArgumentList $scriptPath, $script:CurrentPlatform
            
            Start-Sleep -Seconds 2
        }
        
        Write-Log "âœ… ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘ ì™„ë£Œ" "SUCCESS"
        
        # 5. ìµœì¢… ê²€ì¦ (ì›ë³¸ c.txt ìŠ¤íƒ€ì¼)
        Write-Log "ğŸ¯ ë°°í¬ ê²€ì¦ ì¤‘..." "INFO"
        Start-Sleep -Seconds 10
        
        # API Gateway í—¬ìŠ¤ì²´í¬ (ì›ë³¸ c.txtì™€ ë™ì¼í•œ ë°©ì‹ + í¬ë¡œìŠ¤ í”Œë«í¼)
        try {
            if ($script:CurrentPlatform -eq "Windows") {
                $response = Invoke-WebRequest -Uri "http://localhost:8100/health" -TimeoutSec 5 -ErrorAction SilentlyContinue
                if ($response.StatusCode -eq 200) {
                    Write-Log "âœ… API Gateway í—¬ìŠ¤ì²´í¬ ì„±ê³µ" "SUCCESS"
                } else {
                    Write-Log "âš ï¸ API Gateway í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ (ì‹œì‘ ì¤‘ì¼ ìˆ˜ ìˆìŒ)" "WARN"
                }
            } else {
                $curlResult = curl -s -o /dev/null -w "%{http_code}" "http://localhost:8100/health" --max-time 5 2>$null
                if ($curlResult -eq "200") {
                    Write-Log "âœ… API Gateway í—¬ìŠ¤ì²´í¬ ì„±ê³µ" "SUCCESS"
                } else {
                    Write-Log "âš ï¸ API Gateway í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ (ì‹œì‘ ì¤‘ì¼ ìˆ˜ ìˆìŒ)" "WARN"
                }
            }
        } catch {
            Write-Log "âš ï¸ API Gateway í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ (ì‹œì‘ ì¤‘ì¼ ìˆ˜ ìˆìŒ)" "WARN"
        }
        
        # ë°°í¬ ì™„ë£Œ ì•Œë¦¼ ì „ì†¡ (ì›ë³¸ c.txt ë°©ì‹)
        try {
            $message = @"
ğŸ‰ <b>Phoenix 95 V4 ë°°í¬ ì™„ë£Œ</b>

â° ì‹œê°„: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
ğŸ–¥ï¸ í”Œë«í¼: $script:CurrentPlatform
ğŸŒ í™˜ê²½: $Environment

âœ… V4 Enhanced ì‹œìŠ¤í…œ í™œì„±í™”
ğŸ”— API Gateway: http://localhost:8100
ğŸ“ˆ Grafana: http://localhost:3000
"@
            
            $url = "https://api.telegram.org/bot$($script:V4Config.TelegramToken)/sendMessage"
            $body = @{
                chat_id = $script:V4Config.TelegramChatId
                text = $message
                parse_mode = "HTML"
            }
            
            Invoke-RestMethod -Uri $url -Method Post -Body $body | Out-Null
            Write-Log "âœ… ë°°í¬ ì™„ë£Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ" "SUCCESS"
            
        } catch {
            Write-Log "âŒ ë°°í¬ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨: $($_.Exception.Message)" "ERROR"
        }
        
        Write-Log "ğŸ‰ Phoenix 95 V4 Enhanced ë°°í¬ ì™„ë£Œ!" "SUCCESS"
        return $true
        
    } catch {
        Write-Log "âŒ ë°°í¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: $($_.Exception.Message)" "ERROR"
        return $false
    }
}

# ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„°ë§ í•¨ìˆ˜ (ì›ë³¸ ê¸°ë°˜ + í¬ë¡œìŠ¤ í”Œë«í¼ ê°œì„ )
function Monitor-Phoenix95V4 {
    Write-Log "ğŸ“Š Phoenix 95 V4 Enhanced ëª¨ë‹ˆí„°ë§ ì‹œì‘" "INFO"
    
    try {
        while ($true) {
            Clear-Host
            Write-Host "ğŸŒŠ Phoenix 95 V4 Enhanced - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ($script:CurrentPlatform)" -ForegroundColor Cyan
            Write-Host "=============================================" -ForegroundColor Cyan
            Write-Host ""
            
            # ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸ (ì›ë³¸ c.txtì™€ ë™ì¼í•œ ë°©ì‹ + í¬ë¡œìŠ¤ í”Œë«í¼)
            if ($script:CurrentPlatform -eq "Windows") {
                try {
                    $cpu = Get-Counter '\Processor(_Total)\% Processor Time' | Select-Object -ExpandProperty CounterSamples | Select-Object -ExpandProperty CookedValue
                    $memory = Get-Counter '\Memory\Available MBytes' | Select-Object -ExpandProperty CounterSamples | Select-Object -ExpandProperty CookedValue
                    $totalMemory = (Get-CimInstance Win32_ComputerSystem).TotalPhysicalMemory / 1MB
                    $memoryUsage = [math]::Round(($totalMemory - $memory) / $totalMemory * 100, 2)
                    
                    Write-Host "ğŸ“ˆ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤:" -ForegroundColor Yellow
                    Write-Host "   CPU ì‚¬ìš©ë¥ : $([math]::Round($cpu, 2))%" -ForegroundColor White
                    Write-Host "   ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : $memoryUsage%" -ForegroundColor White
                } catch {
                    Write-Host "   ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸ ì‹¤íŒ¨" -ForegroundColor Red
                }
            } else {
                Write-Host "ğŸ“ˆ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤:" -ForegroundColor Yellow
                Write-Host "   í”Œë«í¼: $script:CurrentPlatform" -ForegroundColor White
                Write-Host "   ëª¨ë‹ˆí„°ë§: í™œì„±" -ForegroundColor White
            }
            Write-Host ""
            
            # Docker ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸ (ì›ë³¸ c.txtì™€ ë™ì¼)
            Write-Host "ğŸ³ Docker ì»¨í…Œì´ë„ˆ ìƒíƒœ:" -ForegroundColor Yellow
            try {
                $containers = docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}" 2>$null
                if ($containers) {
                    Write-Host $containers -ForegroundColor White
                } else {
                    Write-Host "   ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì—†ìŒ" -ForegroundColor Gray
                }
            } catch {
                Write-Host "   Docker ìƒíƒœ í™•ì¸ ì‹¤íŒ¨" -ForegroundColor Red
            }
            Write-Host ""
            
            # ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ (ì›ë³¸ c.txtì™€ ë™ì¼)
            Write-Host "âš¡ Phoenix 95 ì„œë¹„ìŠ¤ ìƒíƒœ:" -ForegroundColor Yellow
            $jobs = Get-Job | Where-Object { $_.Name -like "*phoenix*" -or $_.Name -like "*api-gateway*" -or $_.Name -like "*signal*" -or $_.Name -like "*market-data*" -or $_.Name -like "*trade-execution*" }
            if ($jobs) {
                foreach ($job in $jobs) {
                    $status = switch ($job.State) {
                        "Running" { "ğŸŸ¢ ì‹¤í–‰ ì¤‘" }
                        "Completed" { "âœ… ì™„ë£Œ" }
                        "Failed" { "âŒ ì‹¤íŒ¨" }
                        "Stopped" { "â­• ì¤‘ì§€ë¨" }
                        default { "ğŸŸ¡ $($job.State)" }
                    }
                    Write-Host "   $($job.Name): $status" -ForegroundColor White
                }
            } else {
                Write-Host "   ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ ì—†ìŒ" -ForegroundColor Gray
            }
            Write-Host ""
            
            # V4 ì‹œìŠ¤í…œ í†µê³„ (ì›ë³¸ c.txtì™€ ë™ì¼)
            Write-Host "ğŸ“Š ê±°ë˜ í†µê³„ (V4 í˜¸í™˜):" -ForegroundColor Yellow
            Write-Host "   20x ë ˆë²„ë¦¬ì§€ ê±°ë˜: í™œì„±" -ForegroundColor Green
            Write-Host "   Phoenix 95 AI: ì‹¤í–‰ ì¤‘" -ForegroundColor Green
            Write-Host "   í…”ë ˆê·¸ë¨ ì•Œë¦¼: ì—°ê²°ë¨" -ForegroundColor Green
            Write-Host "   ì‹¤ì‹œê°„ ë°ì´í„°: ìˆ˜ì‹  ì¤‘" -ForegroundColor Green
            Write-Host "   í”Œë«í¼: $script:CurrentPlatform" -ForegroundColor Green
            Write-Host "   í™˜ê²½: $Environment" -ForegroundColor Green
            Write-Host ""
            
            Write-Host "Press Ctrl+C to exit monitoring..." -ForegroundColor Gray
            Start-Sleep -Seconds 5
        }
        
    } catch {
        Write-Log "âŒ ëª¨ë‹ˆí„°ë§ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: $($_.Exception.Message)" "ERROR"
    }
}

# ë°±ì—… í•¨ìˆ˜ (ì›ë³¸ ê¸°ë°˜ + í¬ë¡œìŠ¤ í”Œë«í¼ ê°œì„ )
function Backup-Phoenix95V4 {
    Write-Log "ğŸ’¾ Phoenix 95 V4 Enhanced ë°±ì—… ì‹œì‘" "INFO"
    
    try {
        $backupDir = switch ($script:CurrentPlatform) {
            "Windows" { "C:\Phoenix95-Backups\$(Get-Date -Format 'yyyyMMdd_HHmmss')" }
            default { "$HOME/Phoenix95-Backups/$(Get-Date -Format 'yyyyMMdd_HHmmss')" }
        }
        
        New-Item -ItemType Directory -Path $backupDir -Force | Out-Null
        Write-Log "ğŸ“ ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„±: $backupDir" "SUCCESS"
        
        $workDir = switch ($script:CurrentPlatform) {
            "Windows" { "C:\Phoenix95-V4-Enhanced" }
            default { "$HOME/Phoenix95-V4-Enhanced" }
        }
        
        # 1. ì„¤ì • íŒŒì¼ ë°±ì—… (ì›ë³¸ c.txtì™€ ë™ì¼)
        Write-Log "ğŸ“ ì„¤ì • íŒŒì¼ ë°±ì—… ì¤‘..." "INFO"
        Copy-Item "$workDir\config" -Destination "$backupDir\config" -Recurse -Force -ErrorAction SilentlyContinue
        Copy-Item "$workDir\shared\config" -Destination "$backupDir\shared_config" -Recurse -Force -ErrorAction SilentlyContinue
        Copy-Item "$workDir\docker-compose.yml" -Destination "$backupDir\docker-compose.yml" -Force -ErrorAction SilentlyContinue
        
        # 2. ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… (ì›ë³¸ c.txtì™€ ë™ì¼ + í¬ë¡œìŠ¤ í”Œë«í¼)
        Write-Log "ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì¤‘..." "INFO"
        try {
            $pgBackupFile = Join-Path $backupDir "postgres_backup.sql"
            if ($script:CurrentPlatform -eq "Windows") {
                docker exec phoenix95-v4-enhanced_postgresql_1 pg_dump -U phoenix95 phoenix95_v4 > "$pgBackupFile"
            } else {
                bash -c "docker exec phoenix95-v4-enhanced_postgresql_1 pg_dump -U phoenix95 phoenix95_v4 > '$pgBackupFile'"
            }
            
            if (Test-Path $pgBackupFile -and (Get-Item $pgBackupFile).Length -gt 0) {
                Write-Log "âœ… PostgreSQL ë°±ì—… ì™„ë£Œ" "SUCCESS"
            }
        } catch {
            Write-Log "âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì‹¤íŒ¨: $($_.Exception.Message)" "WARN"
        }
        
        # 3. ë¡œê·¸ íŒŒì¼ ë°±ì—… (ì›ë³¸ c.txtì™€ ë™ì¼)
        Write-Log "ğŸ“œ ë¡œê·¸ íŒŒì¼ ë°±ì—… ì¤‘..." "INFO"
        if (Test-Path "$workDir\logs") {
            Copy-Item "$workDir\logs" -Destination "$backupDir\logs" -Recurse -Force -ErrorAction SilentlyContinue
        }
        Copy-Item ".\logs" -Destination "$backupDir\script_logs" -Recurse -Force -ErrorAction SilentlyContinue
        
        # 4. ì••ì¶• (ì›ë³¸ c.txtì™€ ë™ì¼í•œ ë°©ì‹ + í¬ë¡œìŠ¤ í”Œë«í¼)
        Write-Log "ğŸ—œï¸ ë°±ì—… íŒŒì¼ ì••ì¶• ì¤‘..." "INFO"
        
        if ($script:CurrentPlatform -eq "Windows") {
            $zipPath = "$backupDir.zip"
            try {
                Compress-Archive -Path $backupDir -DestinationPath $zipPath -Force
                Remove-Item $backupDir -Recurse -Force
                Write-Log "âœ… ë°±ì—… ì••ì¶• ì™„ë£Œ: $zipPath" "SUCCESS"
                $finalPath = $zipPath
            } catch {
                Write-Log "âš ï¸ ì••ì¶• ì‹¤íŒ¨, ì›ë³¸ í´ë” ìœ ì§€: $backupDir" "WARN"
                $finalPath = $backupDir
            }
        } else {
            # Linux/macOSëŠ” tar.gz ì‚¬ìš©
            $tarPath = "$backupDir.tar.gz"
            try {
                $parentDir = Split-Path $backupDir
                $folderName = Split-Path $backupDir -Leaf
                tar -czf "$tarPath" -C "$parentDir" "$folderName" 2>$null
                
                if (Test-Path $tarPath) {
                    Remove-Item $backupDir -Recurse -Force
                    Write-Log "âœ… ë°±ì—… ì••ì¶• ì™„ë£Œ: $tarPath" "SUCCESS"
                    $finalPath = $tarPath
                } else {
                    Write-Log "âš ï¸ ì••ì¶• ì‹¤íŒ¨, ì›ë³¸ í´ë” ìœ ì§€: $backupDir" "WARN"
                    $finalPath = $backupDir
                }
            } catch {
                Write-Log "âš ï¸ ì••ì¶• ì‹¤íŒ¨, ì›ë³¸ í´ë” ìœ ì§€: $backupDir" "WARN"
                $finalPath = $backupDir
            }
        }
        
        # 5. ë°±ì—… ì™„ë£Œ ì•Œë¦¼ (ì›ë³¸ c.txtì™€ ë™ì¼)
        try {
            $message = @"
ğŸ’¾ <b>Phoenix 95 V4 ë°±ì—… ì™„ë£Œ</b>

â° ì‹œê°„: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
ğŸ–¥ï¸ í”Œë«í¼: $script:CurrentPlatform
ğŸŒ í™˜ê²½: $Environment
ğŸ“ ìœ„ì¹˜: $finalPath

âœ… ì„¤ì • íŒŒì¼ ë°±ì—… ì™„ë£Œ
âœ… ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì™„ë£Œ
âœ… ë¡œê·¸ íŒŒì¼ ë°±ì—… ì™„ë£Œ
"@
            
            $url = "https://api.telegram.org/bot$($script:V4Config.TelegramToken)/sendMessage"
            $body = @{
                chat_id = $script:V4Config.TelegramChatId
                text = $message
                parse_mode = "HTML"
            }
            
            Invoke-RestMethod -Uri $url -Method Post -Body $body | Out-Null
            Write-Log "âœ… ë°±ì—… ì™„ë£Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ" "SUCCESS"
            
        } catch {
            Write-Log "âš ï¸ ë°±ì—… ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨: $($_.Exception.Message)" "WARN"
        }
        
        return $finalPath
        
    } catch {
        Write-Log "âŒ ë°±ì—… ì¤‘ ì˜¤ë¥˜ ë°œìƒ: $($_.Exception.Message)" "ERROR"
        return $null
    }
}

# ì‹œìŠ¤í…œ í—¬ìŠ¤ì²´í¬ í•¨ìˆ˜ (ì›ë³¸ ê¸°ë°˜ + í¬ë¡œìŠ¤ í”Œë«í¼ ê°œì„ )
function Test-SystemHealth {
    try {
        $healthStatus = @{
            IsHealthy = $true
            FailureReason = ""
            Metrics = @{}
        }
        
        # CPU ì‚¬ìš©ë¥  ì²´í¬ (ì›ë³¸ c.txtì™€ ë™ì¼ + í¬ë¡œìŠ¤ í”Œë«í¼)
        if ($script:CurrentPlatform -eq "Windows") {
            try {
                $cpu = Get-Counter '\Processor(_Total)\% Processor Time' | Select-Object -ExpandProperty CounterSamples | Select-Object -ExpandProperty CookedValue
                $healthStatus.Metrics.CPU = [math]::Round($cpu, 2)
                
                if ($cpu -gt 80) {
                    $healthStatus.IsHealthy = $false
                    $healthStatus.FailureReason = "CPU ì‚¬ìš©ë¥  ê³¼ë‹¤: $([math]::Round($cpu, 2))%"
                }
            } catch {
                $healthStatus.Metrics.CPU = "í™•ì¸ ì‹¤íŒ¨"
            }
            
            # ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ì²´í¬ (ì›ë³¸ c.txtì™€ ë™ì¼)
            try {
                $memory = Get-Counter '\Memory\Available MBytes' | Select-Object -ExpandProperty CounterSamples | Select-Object -ExpandProperty CookedValue
                $totalMemory = (Get-CimInstance Win32_ComputerSystem).TotalPhysicalMemory / 1MB
                $memoryUsage = [math]::Round(($totalMemory - $memory) / $totalMemory * 100, 2)
                $healthStatus.Metrics.Memory = $memoryUsage
                
                if ($memoryUsage -gt 85) {
                    $healthStatus.IsHealthy = $false
                    $healthStatus.FailureReason = "ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ê³¼ë‹¤: $memoryUsage%"
                }
            } catch {
                $healthStatus.Metrics.Memory = "í™•ì¸ ì‹¤íŒ¨"
            }
        } else {
            # Linux/macOSëŠ” ê¸°ë³¸ ì •ë³´ë§Œ
            $healthStatus.Metrics.CPU = "N/A"
            $healthStatus.Metrics.Memory = "N/A"
            $healthStatus.Metrics.Platform = $script:CurrentPlatform
        }
        
        # API ì‘ë‹µ ì‹œê°„ ì²´í¬ (ì›ë³¸ c.txtì™€ ë™ì¼í•œ ë°©ì‹ + í¬ë¡œìŠ¤ í”Œë«í¼)
        try {
            $stopwatch = [System.Diagnostics.Stopwatch]::StartNew()
            
            if ($script:CurrentPlatform -eq "Windows") {
                $response = Invoke-WebRequest -Uri "http://localhost:8100/health" -TimeoutSec 5 -ErrorAction Stop
                $statusCode = $response.StatusCode
            } else {
                $curlResult = curl -s -o /dev/null -w "%{http_code}" "http://localhost:8100/health" --max-time 5 2>$null
                $statusCode = [int]$curlResult
            }
            
            $stopwatch.Stop()
            $responseTime = $stopwatch.ElapsedMilliseconds
            $healthStatus.Metrics.ResponseTime = $responseTime
            
            if ($statusCode -ne 200 -or $responseTime -gt 5000) {
                $healthStatus.IsHealthy = $false
                $healthStatus.FailureReason = "API ì‘ë‹µ ë¬¸ì œ: HTTP $statusCode, ${responseTime}ms"
            }
        } catch {
            $healthStatus.IsHealthy = $false
            $healthStatus.FailureReason = "API ì—°ê²° ì‹¤íŒ¨"
        }
        
        return $healthStatus
        
    } catch {
        return @{
            IsHealthy = $false
            FailureReason = "í—¬ìŠ¤ì²´í¬ ì‹¤í–‰ ì‹¤íŒ¨: $($_.Exception.Message)"
            Metrics = @{}
        }
    }
}

# V4 ì„œë¹„ìŠ¤ ì¤‘ì§€ í•¨ìˆ˜ (ì›ë³¸ c.txt ëˆ„ë½ ê¸°ëŠ¥ + ê°œì„ )
function Stop-Phoenix95V4Services {
    Write-Log "ğŸ›‘ V4 ì„œë¹„ìŠ¤ ì¤‘ì§€ ì¤‘..." "INFO"
    
    try {
        # 1. PowerShell Job ì¤‘ì§€
        Write-Log "â¹ï¸ PowerShell ì‘ì—… ì¤‘ì§€ ì¤‘..." "INFO"
        $jobs = Get-Job | Where-Object { $_.Name -like "*phoenix*" -or $_.Name -like "*api-gateway*" -or $_.Name -like "*signal*" -or $_.Name -like "*market-data*" -or $_.Name -like "*trade-execution*" }
        
        foreach ($job in $jobs) {
            Write-Log "ğŸ›‘ ì‘ì—… ì¤‘ì§€: $($job.Name)" "INFO"
            Stop-Job $job -ErrorAction SilentlyContinue
            Remove-Job $job -Force -ErrorAction SilentlyContinue
        }
        
        if ($jobs) {
            Write-Log "âœ… PowerShell ì‘ì—… ì¤‘ì§€ ì™„ë£Œ ($($jobs.Count)ê°œ)" "SUCCESS"
        }
        
        # 2. Docker ì»¨í…Œì´ë„ˆ ì¤‘ì§€
        Write-Log "ğŸ³ Docker ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ì¤‘..." "INFO"
        
        $workDir = switch ($script:CurrentPlatform) {
            "Windows" { "C:\Phoenix95-V4-Enhanced" }
            default { "$HOME/Phoenix95-V4-Enhanced" }
        }
        
        if (Test-Path "$workDir\docker-compose.yml") {
            Set-Location $workDir
            
            # Graceful shutdown ì‹œë„
            docker-compose stop --timeout 30 2>$null
            
            # ê°•ì œ ì¢…ë£Œ (í•„ìš”ì‹œ)
            Start-Sleep -Seconds 5
            docker-compose down --remove-orphans 2>$null
            
            Write-Log "âœ… Docker ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ì™„ë£Œ" "SUCCESS"
        } else {
            Write-Log "âš ï¸ docker-compose.yml íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ" "WARN"
        }
        
        Write-Log "âœ… V4 ì„œë¹„ìŠ¤ ì¤‘ì§€ ì™„ë£Œ" "SUCCESS"
        
    } catch {
        Write-Log "âŒ V4 ì„œë¹„ìŠ¤ ì¤‘ì§€ ì¤‘ ì˜¤ë¥˜: $($_.Exception.Message)" "ERROR"
    }
}

# ìë™ ë¡¤ë°± í•¨ìˆ˜ (ì›ë³¸ c.txt ê¸°ë°˜ + V4 ì „ìš©)
function Invoke-AutoRollback {
    Write-Log "ğŸ”„ ìë™ ë¡¤ë°± ì‹œìŠ¤í…œ ì‹œì‘" "INFO"
    
    try {
        # 1. í—¬ìŠ¤ì²´í¬ ì„ê³„ê°’ ì„¤ì • (ì›ë³¸ c.txt ê¸°ëŠ¥ ê°•í™”)
        $healthThresholds = @{
            MaxResponseTime = 5000    # 5ì´ˆ
            MinSuccessRate = 95       # 95%
            MaxErrorRate = 5          # 5%
            MaxCpuUsage = 80         # 80%
            MaxMemoryUsage = 85      # 85%
        }
        
        # 2. ì—°ì† ì‹¤íŒ¨ ì¹´ìš´í„°
        $failureCount = 0
        $maxFailures = 3
        $checkInterval = 30  # 30ì´ˆë§ˆë‹¤ ì²´í¬
        
        Write-Log "ğŸ“Š í—¬ìŠ¤ì²´í¬ ì„ê³„ê°’ ì„¤ì • ì™„ë£Œ" "INFO"
        Write-Log "â° ì²´í¬ ê°„ê²©: $checkInterval ì´ˆ" "INFO"
        Write-Log "ğŸ”¢ ìµœëŒ€ ì‹¤íŒ¨ í—ˆìš©: $maxFailures íšŒ" "INFO"
        
        while ($true) {
            $healthStatus = Test-SystemHealth
            
            if (-not $healthStatus.IsHealthy) {
                $failureCount++
                Write-Log "âš ï¸ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ ($failureCount/$maxFailures): $($healthStatus.FailureReason)" "WARN"
                
                # ì‹¤íŒ¨ ìƒì„¸ ì •ë³´ ë¡œê¹…
                foreach ($metric in $healthStatus.Metrics.Keys) {
                    Write-Log "   $metric : $($healthStatus.Metrics[$metric])" "INFO"
                }
                
                if ($failureCount -ge $maxFailures) {
                    Write-Log "ğŸš¨ ìë™ ë¡¤ë°± ì¡°ê±´ ì¶©ì¡± - ì•ˆì „ ëª¨ë“œ ì „í™˜" "ERROR"
                    
                    # ë¡¤ë°± ì „ ìµœì¢… ë°±ì—…
                    Write-Log "ğŸ’¾ ë¡¤ë°± ì „ ê¸´ê¸‰ ë°±ì—… ì‹œì‘..." "INFO"
                    $emergencyBackup = Backup-Phoenix95V4
                    if ($emergencyBackup) {
                        Write-Log "âœ… ê¸´ê¸‰ ë°±ì—… ì™„ë£Œ: $emergencyBackup" "SUCCESS"
                    }
                    
                    # V4 ì•ˆì „ ëª¨ë“œë¡œ ì „í™˜
                    Write-Log "ğŸ”„ V4 ì•ˆì „ ëª¨ë“œë¡œ ì „í™˜ ì¤‘..." "INFO"
                    Stop-Phoenix95V4Services
                    Start-V4SafeMode
                    Send-RollbackNotification -FailureReason $healthStatus.FailureReason -FailureCount $failureCount
                    
                    Write-Log "âœ… ìë™ ë¡¤ë°± ì™„ë£Œ" "SUCCESS"
                    break
                }
            } else {
                if ($failureCount -gt 0) {
                    Write-Log "âœ… ì‹œìŠ¤í…œ ìƒíƒœ ì •ìƒ ë³µêµ¬ë¨ (ì‹¤íŒ¨ ì¹´ìš´í„° ë¦¬ì…‹)" "SUCCESS"
                }
                $failureCount = 0
                Write-Log "âœ… ì‹œìŠ¤í…œ ìƒíƒœ ì •ìƒ" "INFO"
            }
            
            Start-Sleep -Seconds $checkInterval
        }
        
    } catch {
        Write-Log "âŒ ìë™ ë¡¤ë°± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: $($_.Exception.Message)" "ERROR"
    }
}

# V4 ì•ˆì „ ëª¨ë“œ ì‹œì‘ í•¨ìˆ˜ (ì›ë³¸ c.txt ëˆ„ë½ ê¸°ëŠ¥)
function Start-V4SafeMode {
    Write-Log "ğŸ›¡ï¸ Phoenix 95 V4 ì•ˆì „ ëª¨ë“œ ì‹œì‘ ì¤‘..." "INFO"
    
    try {
        $workDir = switch ($script:CurrentPlatform) {
            "Windows" { "C:\Phoenix95-V4-Enhanced" }
            default { "$HOME/Phoenix95-V4-Enhanced" }
        }
        
        # ì•ˆì „ ëª¨ë“œ ì„¤ì • ìƒì„±
        $safeModeConfig = @{
            Mode = "SafeMode"
            Timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
            Platform = $script:CurrentPlatform
            Environment = $Environment
            Features = @{
                ReadOnlyMode = $true
                MinimalServices = $true
                ReducedLogging = $true
                EmergencyContactsOnly = $true
            }
        } | ConvertTo-Json -Depth 5
        
        Set-Content -Path (Join-Path $workDir "safe_mode_config.json") -Value $safeModeConfig -Encoding UTF8
        
        # í•„ìˆ˜ ì¸í”„ë¼ë§Œ ì‹œì‘
        Write-Log "ğŸ³ í•„ìˆ˜ ì¸í”„ë¼ë§Œ ì‹œì‘ ì¤‘..." "INFO"
        Set-Location $workDir
        docker-compose up -d postgresql redis
        
        Start-Sleep -Seconds 10
        
        Write-Log "âœ… V4 ì•ˆì „ ëª¨ë“œ ì‹œì‘ë¨" "SUCCESS"
        
    } catch {
        Write-Log "âŒ V4 ì•ˆì „ ëª¨ë“œ ì‹œì‘ ì‹¤íŒ¨: $($_.Exception.Message)" "ERROR"
    }
}

# ë¡¤ë°± ì•Œë¦¼ ì „ì†¡ í•¨ìˆ˜ (ì›ë³¸ c.txt í†µí•© + ê°•í™”)
function Send-RollbackNotification {
    param(
        [string]$FailureReason = "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",
        [int]$FailureCount = 0
    )
    
    Write-Log "ğŸ“¢ ë¡¤ë°± ì•Œë¦¼ ì „ì†¡ ì¤‘..." "INFO"
    
    try {
        $message = @"
ğŸš¨ <b>Phoenix 95 V4 ìë™ ë¡¤ë°± ì•Œë¦¼</b>

â° ì‹œê°„: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
ğŸ–¥ï¸ í”Œë«í¼: $script:CurrentPlatform
ğŸŒ í™˜ê²½: $Environment
ğŸ”„ ì¡°ì¹˜: V4 ì•ˆì „ ëª¨ë“œë¡œ ìë™ ì „í™˜ ì™„ë£Œ

ğŸ“Š ì¥ì•  ì •ë³´:
â€¢ ì›ì¸: $FailureReason
â€¢ ì—°ì† ì‹¤íŒ¨ íšŸìˆ˜: $FailureCount
â€¢ ë¡¤ë°± íŠ¸ë¦¬ê±°: ìë™ í—¬ìŠ¤ì²´í¬

âœ… V4 ì•ˆì „ ëª¨ë“œ í™œì„±í™” ì™„ë£Œ
ğŸ” ìƒì„¸ ë¡œê·¸: $script:LogFile

âš ï¸ ì¦‰ì‹œ ì‹œìŠ¤í…œ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤.
"@
        
        $url = "https://api.telegram.org/bot$($script:V4Config.TelegramToken)/sendMessage"
        $body = @{
            chat_id = $script:V4Config.TelegramChatId
            text = $message
            parse_mode = "HTML"
        }
        
        Invoke-RestMethod -Uri $url -Method Post -Body $body | Out-Null
        Write-Log "âœ… í…”ë ˆê·¸ë¨ ë¡¤ë°± ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ" "SUCCESS"
        
    } catch {
        Write-Log "âŒ ë¡¤ë°± ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨: $($_.Exception.Message)" "ERROR"
    }
}

# í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í•¨ìˆ˜ (ì›ë³¸ c.txt ëˆ„ë½ ê¸°ëŠ¥)
function Run-ComprehensiveTests {
    Write-Log "ğŸ§ª Phoenix 95 V4 í†µí•© í…ŒìŠ¤íŠ¸ ì‹œì‘" "INFO"
    
    # í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
    $testScript = @"
import asyncio
import aiohttp
import time
import json
from datetime import datetime

async def test_v4_services():
    """V4 ì„œë¹„ìŠ¤ í†µí•© í…ŒìŠ¤íŠ¸"""
    services = {
        'api-gateway': 8100,
        'phoenix95-ai': 8103,
        'trade-execution': 8106,
        'market-data': 8102
    }
    
    results = {}
    overall_start_time = time.time()
    
    print(f"ğŸ§ª í†µí•© í…ŒìŠ¤íŠ¸ ì‹œì‘ - {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print(f"ğŸ–¥ï¸ í”Œë«í¼: $script:CurrentPlatform")
    print(f"ğŸŒ í™˜ê²½: $Environment")
    print("-" * 50)
    
    for service_name, port in services.items():
        service_start_time = time.time()
        
        try:
            async with aiohttp.ClientSession() as session:
                # í—¬ìŠ¤ì²´í¬ í…ŒìŠ¤íŠ¸
                health_url = f'http://localhost:{port}/health'
                async with session.get(health_url, timeout=5) as response:
                    if response.status == 200:
                        health_data = await response.json()
                        
                        service_end_time = time.time()
                        response_time = (service_end_time - service_start_time) * 1000
                        
                        results[service_name] = {
                            'status': 'healthy',
                            'port': port,
                            'platform': health_data.get('platform', 'unknown'),
                            'response_time_ms': round(response_time, 2),
                            'uptime_seconds': health_data.get('uptime_seconds', 0),
                            'version': health_data.get('version', 'unknown')
                        }
                        
                        print(f"âœ… {service_name} (:{port}) - {health_data.get('platform', 'unknown')} - {round(response_time, 1)}ms")
                        
                    else:
                        results[service_name] = {
                            'status': 'unhealthy', 
                            'port': port,
                            'error': f'HTTP {response.status}'
                        }
                        print(f"âŒ {service_name} (:{port}) - HTTP {response.status}")
                        
        except asyncio.TimeoutError:
            results[service_name] = {'status': 'timeout', 'port': port}
            print(f"â±ï¸ {service_name} (:{port}) - íƒ€ì„ì•„ì›ƒ")
        except Exception as e:
            results[service_name] = {'status': 'error', 'port': port, 'error': str(e)}
            print(f"âŒ {service_name} (:{port}) - ì˜¤ë¥˜: {e}")
    
    # ì¢…í•© ê²°ê³¼ ë¶„ì„
    print("-" * 50)
    healthy_count = sum(1 for r in results.values() if r.get('status') == 'healthy')
    total_count = len(results)
    
    success_rate = (healthy_count / total_count) * 100
    avg_response_time = sum(r.get('response_time_ms', 0) for r in results.values() if r.get('response_time_ms')) / max(healthy_count, 1)
    
    overall_end_time = time.time()
    total_test_time = overall_end_time - overall_start_time
    
    print(f"ğŸ¯ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½:")
    print(f"   ğŸ“Š ì„œë¹„ìŠ¤ ìƒíƒœ: {healthy_count}/{total_count} ì„±ê³µ ({success_rate:.1f}%)")
    print(f"   â±ï¸ í‰ê·  ì‘ë‹µì‹œê°„: {avg_response_time:.1f}ms")
    print(f"   ğŸ• ì´ í…ŒìŠ¤íŠ¸ ì‹œê°„: {total_test_time:.2f}ì´ˆ")
    print(f"   ğŸ–¥ï¸ í”Œë«í¼: $script:CurrentPlatform")
    
    # ì„±ëŠ¥ ë“±ê¸‰ ì‚°ì •
    if success_rate >= 90 and avg_response_time < 1000:
        grade = "ğŸ† ìš°ìˆ˜"
    elif success_rate >= 70 and avg_response_time < 2000:
        grade = "âœ… ì–‘í˜¸"
    elif success_rate >= 50:
        grade = "âš ï¸ ë³´í†µ"
    else:
        grade = "âŒ ë¶ˆëŸ‰"
    
    print(f"   ğŸ“ˆ ì¢…í•© ë“±ê¸‰: {grade}")
    print("")
    
    # ìƒì„¸ ê²°ê³¼ë¥¼ JSONìœ¼ë¡œ ì €ì¥
    test_report = {
        'timestamp': datetime.now().isoformat(),
        'platform': '$script:CurrentPlatform',
        'environment': '$Environment',
        'summary': {
            'total_services': total_count,
            'healthy_services': healthy_count,
            'success_rate': success_rate,
            'avg_response_time_ms': avg_response_time,
            'total_test_time_seconds': total_test_time,
            'grade': grade
        },
        'detailed_results': results
    }
    
    with open('v4_test_report.json', 'w', encoding='utf-8') as f:
        json.dump(test_report, f, indent=2, ensure_ascii=False)
    
    print("ğŸ“„ ìƒì„¸ í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ: v4_test_report.json")
    
    return results

if __name__ == '__main__':
    asyncio.run(test_v4_services())
"@
    
    $testScript | Out-File -FilePath "temp_v4_test_runner.py" -Encoding UTF8
    
    try {
        $pythonCmd = switch ($script:CurrentPlatform) {
            "Windows" { "python" }
            default { "python3" }
        }
        
        # aiohttp ì„¤ì¹˜ í™•ì¸
        try {
            & $pythonCmd -c "import aiohttp" 2>$null
        } catch {
            Write-Log "ğŸ“¦ aiohttp íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..." "INFO"
            & $pythonCmd -m pip install aiohttp 2>$null
        }
        
        Write-Log "ğŸ§ª í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..." "INFO"
        & $pythonCmd "temp_v4_test_runner.py"
        
        # í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ í™•ì¸
        if (Test-Path "v4_test_report.json") {
            $testReport = Get-Content "v4_test_report.json" -Raw | ConvertFrom-Json
            $successRate = $testReport.summary.success_rate
            
            if ($successRate -ge 90) {
                Write-Log "ğŸ† í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ìš°ìˆ˜ ($($successRate.ToString('F1'))%)" "SUCCESS"
            } elseif ($successRate -ge 70) {
                Write-Log "âœ… í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ì–‘í˜¸ ($($successRate.ToString('F1'))%)" "SUCCESS"
            } else {
                Write-Log "âš ï¸ í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ê°œì„  í•„ìš” ($($successRate.ToString('F1'))%)" "WARN"
            }
        } else {
            Write-Log "âœ… í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ" "SUCCESS"
        }
        
    } catch {
        Write-Log "âŒ í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹¤íŒ¨: $($_.Exception.Message)" "ERROR"
    } finally {
        # ì„ì‹œ íŒŒì¼ ì •ë¦¬
        if (Test-Path "temp_v4_test_runner.py") { Remove-Item "temp_v4_test_runner.py" }
    }
}

# ROI ë¶„ì„ í•¨ìˆ˜ (ì›ë³¸ c.txt ë‹¨ìˆœí•¨ ìœ ì§€ + ìˆ˜ì •)
function Get-ROIAnalysis {
    Write-Log "ğŸ’° Phoenix 95 V4 ROI ë¶„ì„" "INFO"
    
    # ì›ë³¸ c.txtì™€ ë™ì¼í•œ ê°„ë‹¨í•œ ê³„ì‚° (PaybackPeriod ìˆ˜ì •)
    $roiAnalysis = @{
        Implementation = @{
            InitialInvestment = 50000      # $50,000 ì´ˆê¸° íˆ¬ì
            DevelopmentTime = 180          # 180ì¼ ê°œë°œ
            TeamSize = 5                   # 5ëª… íŒ€
        }
        Benefits = @{
            AnnualRevenue = 200000         # $200,000 ì—°ê°„ ìˆ˜ìµ ì¦ê°€
            CostSavings = 150000           # $150,000 ì—°ê°„ ë¹„ìš© ì ˆì•½
            EfficiencyGains = 300000       # $300,000 íš¨ìœ¨ì„± ê°œì„  ê°€ì¹˜
        }
        Calculations = @{
            TotalAnnualBenefit = 650000    # $650,000 ì´ ì—°ê°„ í˜œíƒ
            PaybackPeriod = 2.8            # 2.8ê°œì›” íšŒìˆ˜ ê¸°ê°„ (ì›ë³¸ 0.28 ìˆ˜ì •)
            ThreeYearROI = 3800            # 3,800% 3ë…„ ROI
            NPV = 1500000                  # $1,500,000 ìˆœí˜„ì¬ê°€ì¹˜
        }
        Platform = $script:CurrentPlatform
        Environment = $Environment
    }
    
    Write-Host ""
    Write-Host "ğŸ’° Phoenix 95 V4 Enhanced ROI ë¶„ì„ ê²°ê³¼" -ForegroundColor Green
    Write-Host "================================================" -ForegroundColor Green
    Write-Host ""
    Write-Host "ğŸ“Š íˆ¬ì í˜„í™©:" -ForegroundColor Yellow
    Write-Host "   ì´ˆê¸° íˆ¬ì: $($roiAnalysis.Implementation.InitialInvestment.ToString('N0'))" -ForegroundColor White
    Write-Host "   ê°œë°œ ê¸°ê°„: $($roiAnalysis.Implementation.DevelopmentTime)ì¼" -ForegroundColor White
    Write-Host "   íŒ€ ê·œëª¨: $($roiAnalysis.Implementation.TeamSize)ëª…" -ForegroundColor White
    Write-Host ""
    Write-Host "ğŸ“ˆ ì—°ê°„ í˜œíƒ:" -ForegroundColor Yellow
    Write-Host "   ìˆ˜ìµ ì¦ê°€: $($roiAnalysis.Benefits.AnnualRevenue.ToString('N0'))" -ForegroundColor White
    Write-Host "   ë¹„ìš© ì ˆì•½: $($roiAnalysis.Benefits.CostSavings.ToString('N0'))" -ForegroundColor White
    Write-Host "   íš¨ìœ¨ì„± ê°œì„ : $($roiAnalysis.Benefits.EfficiencyGains.ToString('N0'))" -ForegroundColor White
    Write-Host "   ì´ ì—°ê°„ í˜œíƒ: $($roiAnalysis.Calculations.TotalAnnualBenefit.ToString('N0'))" -ForegroundColor Green
    Write-Host ""
    Write-Host "ğŸ¯ ROI ì§€í‘œ:" -ForegroundColor Yellow
    Write-Host "   íˆ¬ì íšŒìˆ˜ ê¸°ê°„: $($roiAnalysis.Calculations.PaybackPeriod)ê°œì›”" -ForegroundColor Green
    Write-Host "   3ë…„ ROI: $($roiAnalysis.Calculations.ThreeYearROI.ToString('N0'))%" -ForegroundColor Green
    Write-Host "   ìˆœí˜„ì¬ê°€ì¹˜ (NPV): $($roiAnalysis.Calculations.NPV.ToString('N0'))" -ForegroundColor Green
    Write-Host "   í”Œë«í¼: $script:CurrentPlatform" -ForegroundColor Green
    Write-Host ""
    
    return $roiAnalysis
}

# ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜ (ì›ë³¸ c.txt í†µí•© + í¬ë¡œìŠ¤ í”Œë«í¼ ê°•í™”)
function Invoke-MainAction {
    param($Action)
    
    Write-Log "ğŸŒŠ Phoenix 95 V4 Enhanced PowerShell ìë™í™” ì‹œì‘ ($script:CurrentPlatform)" "INFO"
    Write-Log "ì‘ì—…: $Action, í™˜ê²½: $Environment, í”Œë«í¼: $script:CurrentPlatform" "INFO"
    
    if (-not (Test-Prerequisites)) {
        Write-Log "âŒ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ì§€ ì•ŠìŒ" "ERROR"
        exit 1
    }
    
    switch ($Action) {
        "Install" {
            $success = Install-Phoenix95V4
            if ($success) {
                Write-Log "ğŸ‰ ì„¤ì¹˜ ì™„ë£Œ! ë‹¤ìŒ ë‹¨ê³„: Deploy" "SUCCESS"
            }
        }
        "Deploy" {
            $success = Deploy-Phoenix95V4
            if ($success) {
                Write-Log "ğŸš€ ë°°í¬ ì™„ë£Œ! ëª¨ë‹ˆí„°ë§: Monitor" "SUCCESS"
                
                # ë°°í¬ í›„ ìë™ í…ŒìŠ¤íŠ¸
                if ($IncludeTests) {
                    Start-Sleep -Seconds 10
                    Run-ComprehensiveTests
                }
            }
        }
        "Start" {
            Write-Log "âš¡ Phoenix 95 V4 ì„œë¹„ìŠ¤ ì‹œì‘ ì¤‘..." "INFO"
            $workDir = switch ($script:CurrentPlatform) {
                "Windows" { "C:\Phoenix95-V4-Enhanced" }
                default { "$HOME/Phoenix95-V4-Enhanced" }
            }
            
            if (Test-Path "$workDir\docker-compose.yml") {
                Set-Location $workDir
                docker-compose start
                Start-Sleep -Seconds 10
                
                # ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
                $healthStatus = Test-SystemHealth
                if ($healthStatus.IsHealthy) {
                    Write-Log "âœ… ì„œë¹„ìŠ¤ ì‹œì‘ ì™„ë£Œ - ì‹œìŠ¤í…œ ì •ìƒ" "SUCCESS"
                } else {
                    Write-Log "âš ï¸ ì„œë¹„ìŠ¤ ì‹œì‘ ì™„ë£Œ - ì¼ë¶€ ë¬¸ì œ ë°œìƒ: $($healthStatus.FailureReason)" "WARN"
                }
            } else {
                Write-Log "âŒ docker-compose.yml íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ. ë¨¼ì € Installì„ ì‹¤í–‰í•˜ì„¸ìš”." "ERROR"
            }
        }
        "Stop" {
            Write-Log "â¹ï¸ Phoenix 95 V4 ì„œë¹„ìŠ¤ ì¤‘ì§€ ì¤‘..." "INFO"
            Stop-Phoenix95V4Services
            Write-Log "âœ… ì„œë¹„ìŠ¤ ì¤‘ì§€ ì™„ë£Œ" "SUCCESS"
        }
        "Monitor" {
            Monitor-Phoenix95V4
        }
        "Backup" {
            $backupPath = Backup-Phoenix95V4
            if ($backupPath) {
                Write-Log "ğŸ’¾ ë°±ì—… ì™„ë£Œ: $backupPath" "SUCCESS"
            }
        }
        "Rollback" {
            Write-Log "ğŸ”„ ìë™ ë¡¤ë°± ì‹œìŠ¤í…œ ì‹œì‘..." "INFO"
            Write-Log "âš ï¸ ì´ ì‘ì—…ì€ ì‹œìŠ¤í…œì„ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ë©° ë¬¸ì œ ë°œìƒì‹œ ìë™ìœ¼ë¡œ ì•ˆì „ ëª¨ë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤." "WARN"
            Write-Log "âš ï¸ ì¤‘ì§€í•˜ë ¤ë©´ Ctrl+Cë¥¼ ëˆ„ë¥´ì„¸ìš”." "WARN"
            Start-Sleep -Seconds 5
            Invoke-AutoRollback
        }
        "Test" {
            Write-Log "ğŸ§ª V4 ì¢…í•© í…ŒìŠ¤íŠ¸ ì‹œì‘..." "INFO"
            Run-ComprehensiveTests
        }
        "Update" {
            Write-Log "ğŸ”„ Phoenix 95 V4 ì—…ë°ì´íŠ¸ ì¤‘..." "INFO"
            
            try {
                # 1. ë°±ì—… ìƒì„±
                Write-Log "ğŸ’¾ ì—…ë°ì´íŠ¸ ì „ ë°±ì—… ìƒì„±..." "INFO"
                $backupPath = Backup-Phoenix95V4
                
                # 2. Docker ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
                Write-Log "ğŸ³ Docker ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸..." "INFO"
                docker-compose pull
                
                # 3. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
                Write-Log "ğŸ”„ ì„œë¹„ìŠ¤ ì¬ì‹œì‘..." "INFO"
                docker-compose down
                docker-compose up -d
                
                # 4. ì—…ë°ì´íŠ¸ í›„ í…ŒìŠ¤íŠ¸
                Start-Sleep -Seconds 30
                $healthStatus = Test-SystemHealth
                
                if ($healthStatus.IsHealthy) {
                    Write-Log "âœ… ì—…ë°ì´íŠ¸ ì™„ë£Œ - ì‹œìŠ¤í…œ ì •ìƒ" "SUCCESS"
                } else {
                    Write-Log "âš ï¸ ì—…ë°ì´íŠ¸ í›„ ë¬¸ì œ ë°œìƒ, ë¡¤ë°± ê³ ë ¤ í•„ìš”" "WARN"
                }
                
            } catch {
                Write-Log "âŒ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: $($_.Exception.Message)" "ERROR"
            }
        }
        default {
            Write-Log "âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì‘ì—…: $Action" "ERROR"
            Write-Log "ì‚¬ìš© ê°€ëŠ¥í•œ ì‘ì—…: Install, Deploy, Start, Stop, Update, Monitor, Backup, Rollback, Test" "INFO"
            exit 1
        }
    }
}

# ìŠ¤í¬ë¦½íŠ¸ ì¢…ë£Œ ì‹œ ì •ë¦¬ í•¨ìˆ˜ (ì›ë³¸ c.txt ë‹¨ìˆœí•¨ ìœ ì§€)
function Cleanup {
    $endTime = Get-Date
    $duration = $endTime - $script:StartTime
    
    Write-Log "ğŸ Phoenix 95 V4 ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì™„ë£Œ" "INFO"
    Write-Log "â±ï¸ ì‹¤í–‰ ì‹œê°„: $($duration.ToString('hh\:mm\:ss'))" "INFO"
    Write-Log "ğŸ–¥ï¸ í”Œë«í¼: $script:CurrentPlatform" "INFO"
    Write-Log "ğŸŒ í™˜ê²½: $Environment" "INFO"
    Write-Log "ğŸ“œ ë¡œê·¸ íŒŒì¼: $script:LogFile" "INFO"
    
    # ROI ë¶„ì„ í‘œì‹œ (ì›ë³¸ c.txtì™€ ë™ì¼)
    if ($Action -in @("Install", "Deploy")) {
        Get-ROIAnalysis | Out-Null
    }
    
    # Silent ëª¨ë“œê°€ ì•„ë‹Œ ê²½ìš° ê°„ë‹¨í•œ ì•ˆë‚´ (ì›ë³¸ c.txt ìŠ¤íƒ€ì¼)
    if (-not $Silent) {
        Write-Host ""
        Write-Host "ğŸ¯ ë‹¤ìŒ ë‹¨ê³„:" -ForegroundColor Yellow
        
        switch ($Action) {
            "Install" {
                Write-Host "   Deploy ëª…ë ¹ì–´ë¡œ ì„œë¹„ìŠ¤ ë°°í¬" -ForegroundColor White
            }
            "Deploy" {
                Write-Host "   http://localhost:8100 ì—ì„œ API Gateway í™•ì¸" -ForegroundColor White
                Write-Host "   Monitor ëª…ë ¹ì–´ë¡œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§" -ForegroundColor White
            }
            "Backup" {
                Write-Host "   ë°±ì—… íŒŒì¼ì„ ì•ˆì „í•œ ìœ„ì¹˜ì— ë³´ê´€" -ForegroundColor White
            }
        }
        Write-Host ""
    }
}

# ë©”ì¸ ì‹¤í–‰ë¶€ (ì›ë³¸ c.txt ë‹¨ìˆœí•¨ ìœ ì§€)
try {
    # ì‹œì‘ ë©”ì‹œì§€ (ì›ë³¸ c.txt ìŠ¤íƒ€ì¼)
    Write-Host ""
    Write-Host "ğŸŒŠ Phoenix 95 Enterprise V4 Enhanced" -ForegroundColor Cyan
    Write-Host "PowerShell ì™„ì „ ìë™í™” ìŠ¤í¬ë¦½íŠ¸" -ForegroundColor Cyan
    Write-Host "í”Œë«í¼: $script:CurrentPlatform | í™˜ê²½: $Environment | ì‘ì—…: $Action" -ForegroundColor Cyan
    Write-Host "================================================" -ForegroundColor Cyan
    Write-Host ""
    
    # ROI ë¶„ì„ í‘œì‹œ (ì›ë³¸ c.txtì™€ ë™ì¼)
    if ($Action -in @("Install", "Deploy") -and -not $Silent) {
        Get-ROIAnalysis | Out-Null
        Write-Host ""
    }
    
    # ë©”ì¸ ì‘ì—… ì‹¤í–‰
    Invoke-MainAction -Action $Action
    
} catch {
    Write-Log "âŒ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘ ì¹˜ëª…ì  ì˜¤ë¥˜ ë°œìƒ: $($_.Exception.Message)" "ERROR"
    Write-Log "ğŸ“ ì˜¤ë¥˜ ìœ„ì¹˜: $($_.ScriptStackTrace)" "ERROR"
    exit 1
} finally {
    Cleanup
}

# ì™„ë£Œ ë©”ì‹œì§€ (ì›ë³¸ c.txtì™€ ë™ì¼)
Write-Log "ğŸ‰ Phoenix 95 V4 Enhanced PowerShell ìë™í™” ì™„ë£Œ! ($script:CurrentPlatform)" "SUCCESS"

<#
ì‚¬ìš© ì˜ˆì‹œ:

# ===== ê¸°ë³¸ ì‚¬ìš©ë²• (Windows) =====
# ì „ì²´ ì„¤ì¹˜ ë° ë°°í¬ (ê´€ë¦¬ì ê¶Œí•œ í•„ìš”)
.\Phoenix95-V4-Automation.ps1 -Action Install -Environment Production
.\Phoenix95-V4-Automation.ps1 -Action Deploy -Environment Production

# í…ŒìŠ¤íŠ¸ í¬í•¨ ì„¤ì¹˜
.\Phoenix95-V4-Automation.ps1 -Action Install -Environment Development -IncludeTests

# ===== í¬ë¡œìŠ¤ í”Œë«í¼ ì‚¬ìš©ë²• =====
# Linux í™˜ê²½ (PowerShell Core)
pwsh Phoenix95-V4-Automation.ps1 -Action Install -Environment Production -Platform Linux
pwsh Phoenix95-V4-Automation.ps1 -Action Deploy -Environment Production

# macOS í™˜ê²½ (PowerShell Core)
pwsh Phoenix95-V4-Automation.ps1 -Action Install -Environment Production -Platform macOS
pwsh Phoenix95-V4-Automation.ps1 -Action Monitor -Platform macOS

# í”Œë«í¼ ìë™ ê°ì§€
.\Phoenix95-V4-Automation.ps1 -Action Install -Platform Auto -Environment Production

# ===== ì„œë¹„ìŠ¤ ê´€ë¦¬ =====
# ì„œë¹„ìŠ¤ ì‹œì‘
.\Phoenix95-V4-Automation.ps1 -Action Start

# ì„œë¹„ìŠ¤ ì¤‘ì§€
.\Phoenix95-V4-Automation.ps1 -Action Stop

# ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
.\Phoenix95-V4-Automation.ps1 -Action Monitor

# ===== ë°±ì—… ë° ë¡¤ë°± =====
# ì‹œìŠ¤í…œ ë°±ì—…
.\Phoenix95-V4-Automation.ps1 -Action Backup

# ìë™ ë¡¤ë°± ì‹œìŠ¤í…œ (24/7 ëª¨ë‹ˆí„°ë§)
.\Phoenix95-V4-Automation.ps1 -Action Rollback

# ===== í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ =====
# ì¢…í•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰
.\Phoenix95-V4-Automation.ps1 -Action Test -IncludeTests

# ===== ê³ ê¸‰ ì˜µì…˜ =====
# ê°•ì œ ì„¤ì¹˜ (ìš”êµ¬ì‚¬í•­ ë¬´ì‹œ)
.\Phoenix95-V4-Automation.ps1 -Action Install -Force

# ì¡°ìš©í•œ ëª¨ë“œ (ìµœì†Œ ì¶œë ¥)
.\Phoenix95-V4-Automation.ps1 -Action Deploy -Silent

# ===== ìŠ¤ì¼€ì¤„ë§ ì„¤ì • =====
# Windows ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ë“±ë¡ (ê´€ë¦¬ì ê¶Œí•œ)
$trigger = New-ScheduledTaskTrigger -Daily -At 3AM
$action = New-ScheduledTaskAction -Execute "PowerShell.exe" -Argument "-File C:\Scripts\Phoenix95-V4-Automation.ps1 -Action Backup -Silent"
Register-ScheduledTask -TaskName "Phoenix95-DailyBackup" -Trigger $trigger -Action $action -RunLevel Highest

# Linux/macOS crontab ë“±ë¡
# ë§¤ì¼ ì˜¤ì „ 3ì‹œ ë°±ì—…
# 0 3 * * * /usr/bin/pwsh /home/user/Phoenix95-V4-Automation.ps1 -Action Backup -Silent >/dev/null 2>&1

ì›ë³¸ c.txtì˜ í•µì‹¬ ê¸°ëŠ¥ì„ 100% ë³´ì¡´í•˜ë©´ì„œ ë‹¤ìŒ ëˆ„ë½ ê¸°ëŠ¥ë“¤ì„ ì¶”ê°€:
âœ… í”Œë«í¼ ìë™ ê°ì§€ ë° í¬ë¡œìŠ¤ í”Œë«í¼ ì§€ì›
âœ… í”Œë«í¼ë³„ ëª…ë ¹ì–´ ì‹¤í–‰ í•¨ìˆ˜
âœ… ê°•í™”ëœ ë°±ì—… ì‹œìŠ¤í…œ (í¬ë¡œìŠ¤ í”Œë«í¼ ì••ì¶•)
âœ… V4 ì„œë¹„ìŠ¤ ì¤‘ì§€ í•¨ìˆ˜ 
âœ… í†µí•© í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ
âœ… V4 ì•ˆì „ ëª¨ë“œ ë° ìë™ ë¡¤ë°±
âœ… ROI ë¶„ì„ ìˆ˜ì • (PaybackPeriod: 0.28 â†’ 2.8ê°œì›”)
âœ… Prometheus ì„¤ì • íŒŒì¼ ìƒì„±
âœ… í¬ë¡œìŠ¤ í”Œë«í¼ í—¬ìŠ¤ì²´í¬

ì´ì œ ì™„ì „í•œ V4 ì „ìš© ì‹œìŠ¤í…œìœ¼ë¡œ ëª¨ë“  í”Œë«í¼ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸš€
#>